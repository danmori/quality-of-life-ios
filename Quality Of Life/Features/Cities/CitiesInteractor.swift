//
//  CitiesInteractor.swift
//  Quality Of Life
//
//  Created by Dan Mori on 05/07/22.
//  Copyright (c) 2022 ___ORGANIZATIONNAME___. All rights reserved.
//
//  This file was generated by the Clean Swift Xcode Templates so
//  you can apply clean architecture to your iOS and Mac projects,
//  see http://clean-swift.com
//

import UIKit

protocol CitiesBusinessLogic {
    func getCities(request: Cities.GetCities.Request)
    func showCityDetails(request: Cities.ShowCityDetails.Request)
}

protocol CitiesDataStore {
    var cities: [City] { get set }
    var cityId: String { get set }
}

class CitiesInteractor: CitiesBusinessLogic, CitiesDataStore {
    var presenter: CitiesPresentationLogic?
    var worker: CitiesWorker?
    var cities: [City] = []
    var service: ServiceProvider?
    var cityId: String = ""
    
    init(withServiceProvider service: ServiceProvider) {
        self.service = service
    }
    
    func getCities(request: Cities.GetCities.Request) {
        service?.getMostPopulatedCities {
            switch $0 {
            case .failure(_):
                print("falhou")
            case let .success(citiesResponse):
                self.cities = citiesResponse.cities
                let response = Cities.GetCities.Response(cities: citiesResponse.cities)
                self.presenter?.presentCities(response: response)
            }
        }
    }
    
    func showCityDetails(request: Cities.ShowCityDetails.Request) {
        self.cityId = cities[request.cityIndex].geonameId
        presenter?.presentCityDetails(response: Cities.ShowCityDetails.Response())
    }
}
